感谢您提供的菜单表结构信息和技术选型。基于您的需求，我将为您生成一个基于RBAC权限的后台管理系统的PRD文档。

# 后台管理系统PRD文档（基于RBAC权限模型）

## 1. 项目概述

### 1.1 项目背景

本项目旨在开发一套基于RBAC（基于角色的访问控制）权限模型的后台管理系统，用于企业内部各类资源和业务的统一管理与控制。系统将实现用户、角色、权限的精细化管理，确保各类资源的安全访问。

### 1.2 项目目标

1. 构建一个安全、稳定、高效的后台管理框架
2. 实现基于RBAC的灵活权限控制机制
3. 提供友好的用户界面和操作体验
4. 支持多层级的菜单结构和权限分配
5. 确保系统可扩展性，便于后续功能模块扩展

## 2. 系统架构

### 2.1 技术架构

按照提供的技术选型进行实现：

- 开发语言：Java 17+
- 构建工具：Maven
- 主框架：Spring Boot 3.x
- ORM框架：MyBatis-Plus
- 数据库：MySQL
- 安全框架：Spring Security
- JWT认证：jjwt
- 权限缓存：Redis
- 日志框架：SLF4J + Logback
- API文档：SpringDoc(OpenAPI 3)
- 单元测试：JUnit 5 + Mockito
- 代码简化：Lombok
- 数据校验：Hibernate Validator

### 2.2 系统模块

1. 认证授权模块
2. 用户管理模块
3. 角色管理模块
4. 菜单管理模块
5. 部门管理模块
6. 系统配置模块
7. 操作日志模块
8. 系统监控模块

## 3. 数据库设计

### 3.1 核心表结构

#### 3.1.1 用户表（sys_user）

| 字段名          | 类型     | 长度 | 允许NULL | 主键 | 默认值 | 说明                   |
| --------------- | -------- | ---- | -------- | ---- | ------ | ---------------------- |
| id              | bigint   |      | 否       | 是   |        | 用户ID                 |
| username        | varchar  | 64   | 否       |      |        | 用户名                 |
| password        | varchar  | 255  | 否       |      |        | 密码（加密存储）       |
| name            | varchar  | 64   | 否       |      |        | 真实姓名               |
| phone           | varchar  | 20   |          |      |        | 手机号                 |
| email           | varchar  | 64   |          |      |        | 邮箱                   |
| dept_id         | bigint   |      |          |      |        | 部门ID                 |
| avatar          | varchar  | 255  |          |      |        | 头像URL                |
| status          | tinyint  |      | 否       |      | 1      | 状态（1-正常，0-禁用） |
| remark          | varchar  | 500  |          |      |        | 备注                   |
| create_by       | bigint   |      |          |      |        | 创建者ID               |
| create_time     | datetime |      | 否       |      |        | 创建时间               |
| update_by       | bigint   |      |          |      |        | 更新者ID               |
| update_time     | datetime |      |          |      |        | 更新时间               |
| last_login_time | datetime |      |          |      |        | 最后登录时间           |
| is_deleted      | tinyint  |      | 否       |      | 0      | 是否删除（1-是，0-否） |

#### 3.1.2 部门表（sys_dept）

| 字段名      | 类型     | 长度 | 允许NULL | 主键 | 默认值 | 说明                   |
| ----------- | -------- | ---- | -------- | ---- | ------ | ---------------------- |
| id          | bigint   |      | 否       | 是   |        | 部门ID                 |
| parent_id   | bigint   |      | 否       |      | 0      | 父部门ID               |
| name        | varchar  | 64   | 否       |      |        | 部门名称               |
| leader      | varchar  | 64   |          |      |        | 负责人                 |
| phone       | varchar  | 20   |          |      |        | 联系电话               |
| email       | varchar  | 64   |          |      |        | 邮箱                   |
| status      | tinyint  |      | 否       |      | 1      | 状态（1-正常，0-停用） |
| sort        | int      |      | 否       |      | 0      | 显示顺序               |
| create_time | datetime |      | 否       |      |        | 创建时间               |
| update_time | datetime |      |          |      |        | 更新时间               |
| is_deleted  | tinyint  |      | 否       |      | 0      | 是否删除               |

#### 3.1.3 角色表（sys_role）

| 字段名      | 类型     | 长度 | 允许NULL | 主键 | 默认值 | 说明                   |
| ----------- | -------- | ---- | -------- | ---- | ------ | ---------------------- |
| id          | bigint   |      | 否       | 是   |        | 角色ID                 |
| name        | varchar  | 64   | 否       |      |        | 角色名称               |
| code        | varchar  | 64   | 否       |      |        | 角色编码               |
| status      | tinyint  |      | 否       |      | 1      | 状态（1-正常，0-停用） |
| remark      | varchar  | 500  |          |      |        | 备注                   |
| sort        | int      |      | 否       |      | 0      | 显示顺序               |
| create_by   | bigint   |      |          |      |        | 创建者ID               |
| create_time | datetime |      | 否       |      |        | 创建时间               |
| update_by   | bigint   |      |          |      |        | 更新者ID               |
| update_time | datetime |      |          |      |        | 更新时间               |
| is_deleted  | tinyint  |      | 否       |      | 0      | 是否删除               |

#### 3.1.4 菜单表（sys_menu）

| 字段名      | 类型     | 长度 | 允许NULL | 主键 | 默认值 | 说明                                       |
| ----------- | -------- | ---- | -------- | ---- | ------ | ------------------------------------------ |
| id          | bigint   |      | 否       | 是   |        | ID                                         |
| parent_id   | bigint   |      | 否       |      |        | 父节点ID                                   |
| tree_path   | varchar  | 255  |          |      |        | 父节点路径                                 |
| name        | varchar  | 64   | 否       |      |        | 菜单名称                                   |
| type        | tinyint  |      | 否       |      |        | 菜单类型（1-目录 2-菜单 3-按钮 4-外链）    |
| route_name  | varchar  | 255  |          |      |        | 路由名称（Vue Router 命名路由名称）        |
| route_path  | varchar  | 128  |          |      |        | 路由路径（Vue Router 中定义的 URL 路径）   |
| component   | varchar  | 128  |          |      |        | 组件路径（相对于src/views/，或者后缀.vue） |
| perm        | varchar  | 128  |          |      |        | [按钮] 权限标识                            |
| always_show | tinyint  |      |          |      |        | [目录] 是否一个路由显示（1-是 0-否）       |
| keep_alive  | tinyint  |      |          |      |        | [菜单] 是否开启页面缓存（1-是 0-否）       |
| visible     | tinyint  | 1    |          |      |        | 显示状态（1-显示 0-隐藏）                  |
| sort        | int      |      |          |      |        | 排序                                       |
| icon        | varchar  | 64   |          |      |        | 菜单图标                                   |
| redirect    | varchar  | 128  |          |      |        | 跳转路径                                   |
| create_time | datetime |      |          |      |        | 创建时间                                   |
| update_time | datetime |      |          |      |        | 更新时间                                   |
| params      | varchar  | 255  |          |      |        | 路由参数                                   |

#### 3.1.5 用户角色关联表（sys_user_role）

| 字段名  | 类型   | 长度 | 允许NULL | 主键 | 默认值 | 说明   |
| ------- | ------ | ---- | -------- | ---- | ------ | ------ |
| user_id | bigint |      | 否       | 是   |        | 用户ID |
| role_id | bigint |      | 否       | 是   |        | 角色ID |

#### 3.1.6 角色菜单关联表（sys_role_menu）

| 字段名  | 类型   | 长度 | 允许NULL | 主键 | 默认值 | 说明   |
| ------- | ------ | ---- | -------- | ---- | ------ | ------ |
| role_id | bigint |      | 否       | 是   |        | 角色ID |
| menu_id | bigint |      | 否       | 是   |        | 菜单ID |

#### 3.1.7 操作日志表（sys_operation_log）

| 字段名          | 类型     | 长度 | 允许NULL | 主键 | 默认值 | 说明                       |
| --------------- | -------- | ---- | -------- | ---- | ------ | -------------------------- |
| id              | bigint   |      | 否       | 是   |        | 日志ID                     |
| module          | varchar  | 64   | 否       |      |        | 操作模块                   |
| operation       | varchar  | 64   | 否       |      |        | 操作类型                   |
| method          | varchar  | 128  | 否       |      |        | 方法名称                   |
| request_url     | varchar  | 255  | 否       |      |        | 请求URL                    |
| request_method  | varchar  | 16   | 否       |      |        | 请求方式                   |
| request_param   | text     |      |          |      |        | 请求参数                   |
| response_result | text     |      |          |      |        | 返回结果                   |
| error_msg       | text     |      |          |      |        | 错误消息                   |
| operation_time  | int      |      | 否       |      |        | 操作耗时（毫秒）           |
| user_id         | bigint   |      | 否       |      |        | 操作人ID                   |
| username        | varchar  | 64   | 否       |      |        | 操作人用户名               |
| ip              | varchar  | 64   | 否       |      |        | IP地址                     |
| status          | tinyint  |      | 否       |      | 1      | 操作状态（1-成功，0-失败） |
| create_time     | datetime |      | 否       |      |        | 创建时间                   |

### 3.2 核心关系说明

- 用户-角色：多对多，通过用户角色关联表(sys_user_role)实现
- 角色-菜单：多对多，通过角色菜单关联表(sys_role_menu)实现
- 用户-部门：多对一，用户表直接关联部门ID
- 菜单-菜单：树形结构，通过parent_id自关联

## 4. 功能模块详细说明

### 4.1 用户认证模块

#### 4.1.1 登录流程

1. 用户输入用户名和密码
2. 前端将密码进行加密处理
3. 后端验证用户名和密码
4. 成功后生成JWT令牌返回
5. 前端存储令牌并在后续请求中包含在请求头中
6. 记录登录日志

#### 4.1.2 登出流程

1. 前端发起登出请求
2. 后端将令牌加入黑名单
3. 清除前端存储的令牌
4. 记录登出日志

#### 4.1.3 权限验证流程

1. 前端请求携带JWT令牌
2. 后端验证令牌有效性
3. 获取当前用户权限列表
4. 校验当前请求是否在权限范围内
5. 通过则继续处理，否则返回无权限错误

### 4.2 用户管理模块

#### 4.2.1 功能列表

1. 用户列表（分页查询、条件筛选）
2. 新增用户
3. 编辑用户
4. 删除用户（支持批量）
5. 重置密码
6. 用户状态切换
7. 用户角色分配
8. 用户导入/导出

#### 4.2.2 关键流程

- 新增用户时自动对密码进行加密
- 用户删除采用软删除方式
- 重置密码会生成随机密码或使用系统默认密码
- 分配角色时支持多选

### 4.3 角色管理模块

#### 4.3.1 功能列表

1. 角色列表（分页查询、条件筛选）
2. 新增角色
3. 编辑角色
4. 删除角色（支持批量）
5. 角色状态切换
6. 角色权限分配

#### 4.3.2 关键流程

- 角色编码唯一性验证
- 角色删除时检查是否有用户关联
- 权限分配采用树形结构展示菜单
- 角色权限更新后，关联用户的权限缓存需要刷新

### 4.4 菜单管理模块

#### 4.4.1 功能列表

1. 菜单列表（树形展示）
2. 新增菜单
3. 编辑菜单
4. 删除菜单
5. 菜单可见性切换
6. 菜单排序调整

#### 4.4.2 关键流程

- 菜单按照类型（目录、菜单、按钮、外链）进行不同表单验证
- 删除菜单时需级联删除子菜单
- 新增或编辑菜单后，需要更新前端路由
- 菜单权限标识唯一性校验

### 4.5 部门管理模块

#### 4.5.1 功能列表

1. 部门列表（树形展示）
2. 新增部门
3. 编辑部门
4. 删除部门
5. 部门状态切换
6. 部门排序调整

#### 4.5.2 关键流程

- 部门支持多级管理
- 删除部门时检查是否有用户关联
- 部门删除时需级联删除子部门

### 4.6 系统配置模块

#### 4.6.1 功能列表

1. 系统参数配置
2. 字典管理
3. 系统公告
4. 个人信息设置

#### 4.6.2 关键流程

- 系统参数支持动态刷新
- 字典数据缓存管理
- 个人信息修改不影响权限

### 4.7 日志管理模块

#### 4.7.1 功能列表

1. 操作日志查询
2. 登录日志查询
3. 日志导出

#### 4.7.2 关键流程

- 操作日志通过AOP方式自动记录
- 敏感信息脱敏处理
- 支持多种条件筛选

### 4.8 系统监控模块

#### 4.8.1 功能列表

1. 在线用户监控
2. 服务器资源监控
3. 数据库监控
4. 缓存监控

#### 4.8.2 关键流程

- 实时监控关键指标
- 支持强制下线功能
- 系统资源告警阈值设置

## 5. 安全设计

### 5.1 安全措施

1. 密码加密存储（BCrypt算法）
2. JWT令牌认证
3. 请求参数校验
4. SQL注入防护
5. XSS防护
6. CSRF防护
7. 接口访问频率限制

### 5.2 密码策略

1. 密码复杂度要求（长度、字符类型组合）
2. 密码定期更换提醒
3. 密码错误次数限制
4. 账户锁定机制

### 5.3 日志审计

1. 操作日志完整记录
2. 敏感操作双重验证
3. 异常登录提醒