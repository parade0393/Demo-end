# RBAC权限系统后端API开发计划

## 阶段一：项目初始化与基础框架搭建 (7天)

### 1. 搭建基础框架结构 (1天)
- [ ] 1.1 创建Maven项目，配置pom.xml依赖
- [ ] 1.2 规划项目目录结构
- [ ] 1.3 配置Spring Boot启动类

### 2. 集成基础组件 (2天)
- [ ] 2.1 添加Spring Boot核心配置
- [ ] 2.2 创建HelloWorld示例，测试项目启动
- [ ] 2.3 配置日志框架(SLF4J + Logback)
  - [ ] 2.3.1 创建logback-spring.xml配置文件
  - [ ] 2.3.2 配置控制台和文件输出
  - [ ] 2.3.3 配置日志格式和级别
- [ ] 2.4 配置Lombok
- [ ] 2.5 集成Spring Boot参数校验(Hibernate Validator)
- [ ] 2.6 集成SpringDoc(OpenAPI 3)
  - [ ] 2.6.1 配置Swagger文档信息
  - [ ] 2.6.2 创建API文档配置类

### 3. 异常处理与规范化响应 (1天)
- [ ] 3.1 创建统一响应结果类(Result)
- [ ] 3.2 创建全局异常处理器(GlobalExceptionHandler)
- [ ] 3.3 定义业务异常类(BusinessException)
- [ ] 3.4 实现统一响应拦截器(ResponseAdvice)

### 4. 数据库配置 (1天)
- [ ] 4.1 配置MySQL数据源
- [ ] 4.2 集成MyBatis-Plus
  - [ ] 4.2.1 配置MyBatis-Plus基础设置
  - [ ] 4.2.2 配置分页插件
  - [ ] 4.2.3 配置乐观锁插件
  - [ ] 4.2.4 配置逻辑删除
- [ ] 4.3 创建基础实体类BaseEntity(含通用字段)

### 5. Redis配置 (1天)
- [ ] 5.1 添加Redis依赖和配置
- [ ] 5.2 创建Redis工具类(RedisUtil)
- [ ] 5.3 配置Redis序列化方式
- [ ] 5.4 配置Redis缓存管理器

### 6. 安全相关基础配置 (1天)
- [ ] 6.1 添加Spring Security依赖
- [ ] 6.2 添加JWT依赖(jjwt)
- [ ] 6.3 创建安全相关基础配置类
- [ ] 6.4 创建加密工具类(EncryptUtil, BCryptUtil)

## 阶段二：数据库设计与实体类开发 (5天)

### 1. 创建数据库表结构 (2天)
- [ ] 1.1 设计并创建用户表(sys_user)
- [ ] 1.2 设计并创建角色表(sys_role)
- [ ] 1.3 设计并创建菜单表(sys_menu)
- [ ] 1.4 设计并创建用户角色关联表(sys_user_role)
- [ ] 1.5 设计并创建角色权限关联表(sys_role_menu)
- [ ] 1.6 设计并创建部门表(sys_dept)
- [ ] 1.7 设计并创建操作日志表(sys_operation_log)
- [ ] 1.8 设计并创建登录日志表(sys_login_log)

### 2. 创建实体类 (1天)
- [ ] 2.1 创建User实体类
- [ ] 2.2 创建Role实体类
- [ ] 2.3 创建Permission实体类
- [ ] 2.4 创建Menu实体类
- [ ] 2.5 创建UserRole实体类
- [ ] 2.6 创建RolePermission实体类
- [ ] 2.7 创建Department实体类
- [ ] 2.8 创建Api实体类
- [ ] 2.9 创建OperationLog实体类
- [ ] 2.10 创建LoginLog实体类

### 3. 创建数据传输对象(DTO/VO/Param) (2天)
- [ ] 3.1 创建用户相关DTO/VO/Param
  - [ ] 3.1.1 UserDTO, UserVO, UserCreateParam, UserUpdateParam
  - [ ] 3.1.2 UserPasswordParam, UserRoleParam
- [ ] 3.2 创建角色相关DTO/VO/Param
  - [ ] 3.2.1 RoleDTO, RoleVO, RoleCreateParam, RoleUpdateParam
  - [ ] 3.2.2 RolePermissionParam
- [ ] 3.3 创建权限相关DTO/VO/Param
  - [ ] 3.3.1 PermissionDTO, PermissionVO, PermissionCreateParam, PermissionUpdateParam
- [ ] 3.4 创建菜单相关DTO/VO/Param
  - [ ] 3.4.1 MenuDTO, MenuVO, MenuCreateParam, MenuUpdateParam
  - [ ] 3.4.2 MenuTreeVO
- [ ] 3.5 创建部门相关DTO/VO/Param
  - [ ] 3.5.1 DeptDTO, DeptVO, DeptCreateParam, DeptUpdateParam
  - [ ] 3.5.2 DeptTreeVO
- [ ] 3.6 创建日志相关DTO/VO/Param
  - [ ] 3.6.1 OperationLogVO, LoginLogVO, LogQueryParam

## 阶段三：安全认证授权框架开发 (8天)

### 1. JWT工具与配置 (2天)
- [ ] 1.1 创建JWT工具类(JwtTokenUtil)
  - [ ] 1.1.1 实现token生成方法
  - [ ] 1.1.2 实现token解析方法
  - [ ] 1.1.3 实现token验证方法
  - [ ] 1.1.4 实现token刷新方法
- [ ] 1.2 创建JWT配置类
  - [ ] 1.2.1 配置token有效期
  - [ ] 1.2.2 配置token签名密钥
  - [ ] 1.2.3 配置token头部信息

### 2. Spring Security核心配置 (3天)
- [ ] 2.1 配置SecurityConfig类
  - [ ] 2.1.1 配置安全过滤链
  - [ ] 2.1.2 配置密码编码器
  - [ ] 2.1.3 配置认证管理器
  - [ ] 2.1.4 配置核心过滤器
  - [ ] 2.1.5 配置放行白名单
- [ ] 2.2 创建JwtAuthenticationFilter
  - [ ] 2.2.1 实现token提取逻辑
  - [ ] 2.2.2 实现认证信息设置到SecurityContext
  - [ ] 2.2.3 实现token过期处理
- [ ] 2.3 创建自定义UserDetailsService
  - [ ] 2.3.1 实现用户查询加载逻辑
  - [ ] 2.3.2 实现用户权限加载逻辑
- [ ] 2.4 创建认证成功处理器(AuthSuccessHandler)
- [ ] 2.5 创建认证失败处理器(AuthFailureHandler)
- [ ] 2.6 创建未认证处理器(AnonymousHandler)
- [ ] 2.7 创建访问拒绝处理器(AccessDeniedHandler)

## 阶段四：认证模块开发 (3天)

### 1. 用户认证接口 (2天)
- [ ] 1.1 创建AuthController
  - [ ] 1.1.1 实现登录接口(/api/auth/login)
  - [ ] 1.1.2 实现刷新令牌接口(/api/auth/refresh)
  - [ ] 1.1.3 实现注销接口(/api/auth/logout)
  - [ ] 1.1.4 实现获取当前用户信息接口(/api/auth/info)
- [ ] 1.2 创建AuthService接口及实现
  - [ ] 1.2.1 实现用户认证逻辑
  - [ ] 1.2.2 实现JWT生成逻辑
  - [ ] 1.2.3 实现注销逻辑
  - [ ] 1.2.4 实现Token刷新逻辑

### 2. 登录日志记录 (1天)
- [ ] 2.1 创建登录日志切面(LoginLogAspect)
- [ ] 2.2 实现登录成功日志记录
- [ ] 2.3 实现登录失败日志记录
- [ ] 2.4 集成IP地址解析功能

## 阶段五：用户管理模块开发 (4天)

### 1. 用户基础功能 (2天)
- [ ] 1.1 创建UserMapper
  - [ ] 1.1.1 编写基础CRUD方法
  - [ ] 1.1.2 编写自定义查询方法
  - [ ] 1.1.3 编写XML映射文件
- [ ] 1.2 创建UserService接口及实现
  - [ ] 1.2.1 实现创建用户方法
  - [ ] 1.2.2 实现更新用户方法
  - [ ] 1.2.3 实现删除用户方法
  - [ ] 1.2.4 实现查询用户列表方法
  - [ ] 1.2.5 实现获取用户详情方法
  - [ ] 1.2.6 实现修改密码方法
  - [ ] 1.2.7 实现重置密码方法
- [ ] 1.3 创建UserController
  - [ ] 1.3.1 实现创建用户接口(/api/users)
  - [ ] 1.3.2 实现更新用户接口(/api/users/{id})
  - [ ] 1.3.3 实现删除用户接口(/api/users/{id})
  - [ ] 1.3.4 实现查询用户列表接口(/api/users)
  - [ ] 1.3.5 实现获取用户详情接口(/api/users/{id})
  - [ ] 1.3.6 实现修改密码接口(/api/users/password)
  - [ ] 1.3.7 实现重置密码接口(/api/users/{id}/password/reset)

### 2. 用户角色管理 (1天)
- [ ] 2.1 创建UserRoleMapper
  - [ ] 2.1.1 编写基础CRUD方法
  - [ ] 2.1.2 编写自定义查询方法
- [ ] 2.2 在UserService中实现用户角色管理方法
  - [ ] 2.2.1 实现分配用户角色方法
  - [ ] 2.2.2 实现获取用户角色方法
- [ ] 2.3 在UserController中实现用户角色管理接口
  - [ ] 2.3.1 实现用户分配角色接口(/api/users/{id}/roles)
  - [ ] 2.3.2 实现获取用户角色接口(/api/users/{id}/roles)

### 3. 用户状态管理 (1天)
- [ ] 3.1 在UserService中实现用户状态管理方法
  - [ ] 3.1.1 实现启用/禁用用户方法
  - [ ] 3.1.2 实现锁定/解锁用户方法
- [ ] 3.2 在UserController中实现用户状态管理接口
  - [ ] 3.2.1 实现启用/禁用用户接口(/api/users/{id}/status)
  - [ ] 3.2.2 实现锁定/解锁用户接口(/api/users/{id}/lock)
- [ ] 3.3 实现登录失败锁定机制

## 阶段六：角色与权限模块开发 (7天)

### 1. 角色管理 (2天)
- [ ] 1.1 创建RoleMapper
  - [ ] 1.1.1 编写基础CRUD方法
  - [ ] 1.1.2 编写自定义查询方法
  - [ ] 1.1.3 编写XML映射文件
- [ ] 1.2 创建RoleService接口及实现
  - [ ] 1.2.1 实现创建角色方法
  - [ ] 1.2.2 实现更新角色方法
  - [ ] 1.2.3 实现删除角色方法
  - [ ] 1.2.4 实现查询角色列表方法
  - [ ] 1.2.5 实现获取角色详情方法
- [ ] 1.3 创建RoleController
  - [ ] 1.3.1 实现创建角色接口(/api/roles)
  - [ ] 1.3.2 实现更新角色接口(/api/roles/{id})
  - [ ] 1.3.3 实现删除角色接口(/api/roles/{id})
  - [ ] 1.3.4 实现查询角色列表接口(/api/roles)
  - [ ] 1.3.5 实现获取角色详情接口(/api/roles/{id})

### 2. 权限管理 (2天)
- [ ] 2.1 创建PermissionMapper
  - [ ] 2.1.1 编写基础CRUD方法
  - [ ] 2.1.2 编写自定义查询方法
- [ ] 2.2 创建PermissionService接口及实现
  - [ ] 2.2.1 实现创建权限方法
  - [ ] 2.2.2 实现更新权限方法
  - [ ] 2.2.3 实现删除权限方法
  - [ ] 2.2.4 实现查询权限列表方法
- [ ] 2.3 创建PermissionController
  - [ ] 2.3.1 实现创建权限接口(/api/permissions)
  - [ ] 2.3.2 实现更新权限接口(/api/permissions/{id})
  - [ ] 2.3.3 实现删除权限接口(/api/permissions/{id})
  - [ ] 2.3.4 实现查询权限列表接口(/api/permissions)

### 3. 角色权限管理 (2天)
- [ ] 3.1 创建RolePermissionMapper
  - [ ] 3.1.1 编写基础CRUD方法
  - [ ] 3.1.2 编写自定义查询方法
- [ ] 3.2 在RoleService中实现角色权限管理方法
  - [ ] 3.2.1 实现分配角色权限方法
  - [ ] 3.2.2 实现获取角色权限方法
- [ ] 3.3 在RoleController中实现角色权限管理接口
  - [ ] 3.3.1 实现角色分配权限接口(/api/roles/{id}/permissions)
  - [ ] 3.3.2 实现获取角色权限接口(/api/roles/{id}/permissions)
- [ ] 3.4 实现角色权限缓存刷新机制

### 4. 角色继承关系 (1天)
- [ ] 4.1 在RoleService中实现角色继承关系方法
  - [ ] 4.1.1 实现设置角色父级方法
  - [ ] 4.1.2 实现获取角色继承树方法
  - [ ] 4.1.3 实现获取角色所有权限方法(包含继承权限)
- [ ] 4.2 在RoleController中实现角色继承关系接口
  - [ ] 4.2.1 实现设置角色父级接口(/api/roles/{id}/parent)
  - [ ] 4.2.2 实现获取角色继承树接口(/api/roles/tree)

## 阶段七：菜单与资源模块开发 (5天)

### 1. 菜单管理 (2天)
- [ ] 1.1 创建MenuMapper
  - [ ] 1.1.1 编写基础CRUD方法
  - [ ] 1.1.2 编写自定义查询方法
  - [ ] 1.1.3 编写树形结构查询方法
- [ ] 1.2 创建MenuService接口及实现
  - [ ] 1.2.1 实现创建菜单方法
  - [ ] 1.2.2 实现更新菜单方法
  - [ ] 1.2.3 实现删除菜单方法
  - [ ] 1.2.4 实现查询菜单树方法
  - [ ] 1.2.5 实现获取用户菜单方法
- [ ] 1.3 创建MenuController
  - [ ] 1.3.1 实现创建菜单接口(/api/menus)
  - [ ] 1.3.2 实现更新菜单接口(/api/menus/{id})
  - [ ] 1.3.3 实现删除菜单接口(/api/menus/{id})
  - [ ] 1.3.4 实现查询菜单树接口(/api/menus/tree)
  - [ ] 1.3.5 实现获取当前用户菜单接口(/api/menus/user)

### 2. API资源管理 (2天)
- [ ] 2.1 创建ApiMapper
  - [ ] 2.1.1 编写基础CRUD方法
  - [ ] 2.1.2 编写自定义查询方法
- [ ] 2.2 创建ApiService接口及实现
  - [ ] 2.2.1 实现创建API方法
  - [ ] 2.2.2 实现更新API方法
  - [ ] 2.2.3 实现删除API方法
  - [ ] 2.2.4 实现查询API列表方法
  - [ ] 2.2.5 实现API权限关联方法
- [ ] 2.3 创建ApiController
  - [ ] 2.3.1 实现创建API接口(/api/resources/apis)
  - [ ] 2.3.2 实现更新API接口(/api/resources/apis/{id})
  - [ ] 2.3.3 实现删除API接口(/api/resources/apis/{id})
  - [ ] 2.3.4 实现查询API列表接口(/api/resources/apis)
  - [ ] 2.3.5 实现API权限关联接口(/api/resources/apis/{id}/permission)

### 3. API资源扫描 (1天)
- [ ] 3.1 创建API扫描器(ApiScanner)
  - [ ] 3.1.1 实现RequestMapping注解扫描
  - [ ] 3.1.2 实现自定义权限注解扫描
  - [ ] 3.1.3 实现API与权限自动关联
- [ ] 3.2 创建扫描配置类(ApiScanConfig)
- [ ] 3.3 实现API资源扫描接口(/api/resources/apis/scan)

## 阶段八：部门与数据权限模块开发 (5天)

### 1. 部门管理 (2天)
- [ ] 1.1 创建DeptMapper
  - [ ] 1.1.1 编写基础CRUD方法
  - [ ] 1.1.2 编写自定义查询方法
  - [ ] 1.1.3 编写树形结构查询方法
- [ ] 1.2 创建DeptService接口及实现
  - [ ] 1.2.1 实现创建部门方法
  - [ ] 1.2.2 实现更新部门方法
  - [ ] 1.2.3 实现删除部门方法
  - [ ] 1.2.4 实现查询部门树方法
- [ ] 1.3 创建DeptController
  - [ ] 1.3.1 实现创建部门接口(/api/depts)
  - [ ] 1.3.2 实现更新部门接口(/api/depts/{id})
  - [ ] 1.3.3 实现删除部门接口(/api/depts/{id})
  - [ ] 1.3.4 实现查询部门树接口(/api/depts/tree)

### 2. 数据权限设计 (1天)
- [ ] 2.1 设计数据权限规则表(sys_data_rule)
  - [ ] 2.1.1 创建表结构
  - [ ] 2.1.2 创建实体类
- [ ] 2.2 创建DataRuleMapper、Service和Controller
  - [ ] 2.2.1 实现基本CRUD操作
  - [ ] 2.2.2 实现规则与角色关联

### 3. 数据权限实现 (2天)
- [ ] 3.1 创建数据权限注解(DataScope)
- [ ] 3.2 创建数据权限拦截器(DataScopeInterceptor)
  - [ ] 3.2.1 实现SQL动态拼接
  - [ ] 3.2.2 实现不同数据权限类型处理
- [ ] 3.3 创建数据权限处理器(DataScopeHandler)
  - [ ] 3.3.1 实现全部数据权限处理
  - [ ] 3.3.2 实现本部门数据权限处理
  - [ ] 3.3.3 实现本部门及子部门数据权限处理
  - [ ] 3.3.4 实现仅本人数据权限处理
  - [ ] 3.3.5 实现自定义数据权限处理

## 阶段九：日志与监控模块开发 (3天)

### 1. 操作日志 (1.5天)
- [ ] 1.1 创建OperationLogMapper
  - [ ] 1.1.1 编写基础CRUD方法
  - [ ] 1.1.2 编写高级查询方法
- [ ] 1.2 创建操作日志注解(OperationLog)
- [ ] 1.3 创建操作日志切面(OperationLogAspect)
  - [ ] 1.3.1 实现操作信息采集
  - [ ] 1.3.2 实现操作结果记录
  - [ ] 1.3.3 实现异步日志保存
- [ ] 1.4 创建LogService与LogController
  - [ ] 1.4.1 实现查询操作日志接口(/api/logs/operation)
  - [ ] 1.4.2 实现导出操作日志功能

### 2. 登录日志查询 (0.5天)
- [ ] 2.1 在LogService中实现登录日志查询方法
- [ ] 2.2 在LogController中实现查询登录日志接口(/api/logs/login)

###.3 接口限流实现 (1天)
- [ ] 3.1 创建限流注解(RateLimit)
- [ ] 3.2 创建限流切面(RateLimitAspect)
  - [ ] 3.2.1 集成Guava RateLimiter
  - [ ] 3.2.2 实现不同粒度的限流
- [ ] 3.3 创建Redis分布式限流实现

## 阶段十：系统优化与集成测试 (6天)

### 1. 权限缓存优化 (2天)
- [ ] 1.1 设计并实现Redis权限缓存结构
  - [ ] 1.1.1 用户权限缓存设计
  - [ ] 1.1.2 角色权限缓存设计
  - [ ] 1.1.3 资源权限缓存设计
- [ ] 1.2 实现权限缓存管理器(PermissionCacheManager)
  - [ ] 1.2.1 实现加载缓存方法
  - [ ] 1.2.2 实现刷新缓存方法
  - [ ] 1.2.3 实现清除缓存方法
- [ ] 1.3 接入权限变更监听器(PermissionChangeListener)
  - [ ] 1.3.1 用户相关变更监听
  - [ ] 1.3.2 角色相关变更监听
  - [ ] 1.3.3 权限相关变更监听

### 2. 集成测试 (3天)
- [ ] 2.1 单元测试
  - [ ] 2.1.1 编写Service层测试用例
  - [ ] 2.1.2 编写关键业务逻辑测试用例
- [ ] 2.2 接口测试
  - [ ] 2.2.1 编写Controller层测试用例
  - [ ] 2.2.2 测试权限校验逻辑
- [ ] 2.3 集成测试
  - [ ] 2.3.1 测试完整认证授权流程
  - [ ] 2.3.2 测试数据权限过滤效果
  - [ ] 2.3.3 测试权限缓存效果
- [ ] 2.4 性能测试
  - [ ] 2.4.1 测试并发登录性能
  - [ ] 2.4.2 测试权限校验性能

### 3. 系统文档与部署 (1天)
- [ ] 3.1 完善API文档
  - [ ] 3.1.1 检查所有API的文档注释
  - [ ] 3.1.2 添加接口使用示例
- [ ] 3.2 编写部署文档
  - [ ] 3.2.1 编写环境要求
  - [ ] 3.2.2 编写部署步骤
  - [ ] 3.2.3 编写配置说明
- [ ] 3.3 准备发布包
  - [ ] 3.3.1 配置Maven打包插件
  - [ ] 3.3.2 生成可执行JAR包

## 开发时间表

| 阶段     | 任务                     | 时间估计 | 依赖               |
| -------- | ------------------------ | -------- | ------------------ |
| 一       | 项目初始化与基础框架搭建 | 7天      | 无                 |
| 二       | 数据库设计与实体类开发   | 5天      | 阶段一             |
| 三       | 安全认证授权框架开发     | 8天      | 阶段一、二         |
| 四       | 认证模块开发             | 3天      | 阶段一、二、三     |
| 五       | 用户管理模块开发         | 4天      | 阶段一、二、三     |
| 六       | 角色与权限模块开发       | 7天      | 阶段一、二、三     |
| 七       | 菜单与资源模块开发       | 5天      | 阶段一、二、三、六 |
| 八       | 部门与数据权限模块开发   | 5天      | 阶段一、二、三、五 |
| 九       | 日志与监控模块开发       | 3天      | 阶段一、二、三     |
| 十       | 系统优化与集成测试       | 6天      | 所有前置阶段       |
| **总计** |                          | **53天** |                    |

## 风险点及应对策略

1. **权限模型设计复杂度高**
   - 应对：先搭建简化版本，确保基本功能正常，再逐步添加高级特性

2. **数据权限实现难度大**
   - 应对：分阶段实现，先支持基本数据权限类型，后续迭代完善

3. **缓存一致性问题**
   - 应对：设计完善的缓存更新机制，确保权限变更时及时刷新缓存

4. **安全性风险**
   - 应对：定期进行安全审计，遵循安全最佳实践

5. **性能问题**
   - 应对：关注SQL优化，合理使用缓存，进行性能测试